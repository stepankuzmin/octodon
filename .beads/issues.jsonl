{"id":"octodon-0541","content_hash":"2f1866f4ba7933c57872064aaf5ba946726a850e3d2fa25972142b857fd713e0","title":"Implement ActivityPub Actor endpoint","description":"Implement ActivityPub Actor endpoint to serve account profile in ActivityPub format.\n\n**Endpoint:** `GET /users/{username}` with `Accept: application/activity+json` header\n\n**Response format:**\n```json\n{\n  \"@context\": [\n    \"https://www.w3.org/ns/activitystreams\",\n    \"https://w3id.org/security/v1\"\n  ],\n  \"id\": \"https://octodon.stepan-kuzmin.workers.dev/users/stepan\",\n  \"type\": \"Person\",\n  \"preferredUsername\": \"stepan\",\n  \"name\": \"Stepan Kuzmin\",\n  \"summary\": \"\u003cp\u003eYour bio goes here\u003c/p\u003e\",\n  \"url\": \"https://octodon.stepan-kuzmin.workers.dev/@stepan\",\n  \"inbox\": \"https://octodon.stepan-kuzmin.workers.dev/users/stepan/inbox\",\n  \"outbox\": \"https://octodon.stepan-kuzmin.workers.dev/users/stepan/outbox\",\n  \"followers\": \"https://octodon.stepan-kuzmin.workers.dev/users/stepan/followers\",\n  \"following\": \"https://octodon.stepan-kuzmin.workers.dev/users/stepan/following\",\n  \"icon\": {\n    \"type\": \"Image\",\n    \"mediaType\": \"image/jpeg\",\n    \"url\": \"https://avatars.githubusercontent.com/u/533564\"\n  },\n  \"publicKey\": {\n    \"id\": \"https://octodon.stepan-kuzmin.workers.dev/users/stepan#main-key\",\n    \"owner\": \"https://octodon.stepan-kuzmin.workers.dev/users/stepan\",\n    \"publicKeyPem\": \"-----BEGIN PUBLIC KEY-----\\n...\\n-----END PUBLIC KEY-----\"\n  }\n}\n```\n\n**Implementation notes:**\n- Check `Accept` header for `application/activity+json` or `application/ld+json`\n- Convert account.json data to ActivityPub format\n- Generate or load public key for HTTP signatures\n- Return appropriate content-type header\n- Add CORS headers\n\n**Dependencies:**\n- Requires WebFinger endpoint (octodon-9711)\n\n**References:**\n- ActivityPub spec: https://www.w3.org/TR/activitypub/\n- Mastodon Actor: https://docs.joinmastodon.org/spec/activitypub/#Actor","status":"open","priority":1,"issue_type":"feature","created_at":"2025-11-02T16:29:22.182618+02:00","updated_at":"2025-11-02T16:29:22.182618+02:00"}
{"id":"octodon-225e","content_hash":"bf0f120febcfbd48aec02a6bb50eae20c099124fdbc08534f68d31a80e38a1e2","title":"Update build process to generate ActivityPub-formatted data","description":"Optionally update build.ts to pre-generate ActivityPub-formatted posts alongside Mastodon API format.\n\n**Purpose:**\n- Avoid converting posts from Mastodon format to ActivityPub format on every request\n- Improve worker performance\n- Maintain single source of truth in posts.json\n\n**Current:**\n```json\n{\n  \"account\": { /* Mastodon Account */ },\n  \"statuses\": [ /* Mastodon Status objects */ ]\n}\n```\n\n**Option A: Dual format in posts.json:**\n```json\n{\n  \"account\": { /* Mastodon Account */ },\n  \"actor\": { /* ActivityPub Actor */ },\n  \"statuses\": [ /* Mastodon Status objects */ ],\n  \"activities\": [ /* ActivityPub Create activities */ ]\n}\n```\n\n**Option B: Separate files:**\n- `posts.json` - Mastodon API format (existing)\n- `actor.json` - ActivityPub Actor\n- `outbox.json` - ActivityPub activities\n\n**Option C: Convert on-the-fly (no build changes):**\n- Keep current format\n- Worker converts to ActivityPub when needed\n- Simpler but slightly slower\n\n**Implementation notes:**\n- Option C is fine for low traffic\n- Option A keeps everything in one place\n- Consider file size impact\n- May not be needed until performance becomes an issue\n\n**Dependencies:**\n- Only relevant after ActivityPub endpoints are implemented\n- Can defer until performance testing\n\n**Decision needed:**\n- Test Option C first (no build changes)\n- Only implement if performance is an issue","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-02T16:30:35.970715+02:00","updated_at":"2025-11-02T16:30:35.970715+02:00"}
{"id":"octodon-2bcf","content_hash":"46e75d9813e4528d37109665741449a217b3bd801f1e7d5d3c64533d0f250214","title":"Enable ActivityPub federation support","description":"Implement ActivityPub protocol to enable federation with Mastodon and other fediverse servers.\n\n**Goal:**\nAllow users on other Mastodon instances (like mastodon.social) to follow and view posts from Octodon accounts by implementing the ActivityPub protocol.\n\n**Current state:**\n- ✅ Mastodon API endpoints (for client apps like Elk, Ivory)\n- ❌ ActivityPub protocol (for server-to-server federation)\n\n**Required components:**\n\n**Phase 1: Discovery \u0026 Profile (P1 - High priority)**\n- WebFinger endpoint (octodon-9711) - Required first\n- ActivityPub Actor endpoint (octodon-0541)\n- Individual Note/Object endpoints (octodon-85c2)\n\n**Phase 2: Content Federation (P1 - High priority)**  \n- Outbox endpoint (octodon-61de)\n- Followers/Following collections (octodon-ccf3)\n\n**Phase 3: Interactions (P2 - Medium priority)**\n- Inbox endpoint (octodon-87e5)\n- HTTP Signatures (octodon-6af9)\n\n**Phase 4: Optimization (P3 - Low priority)**\n- Build process updates (octodon-225e)\n\n**Minimal viable federation:**\nImplementing Phase 1 + Phase 2 enables:\n- Discovery via WebFinger\n- Viewing profile from other instances\n- Fetching posts from Outbox\n- **Basic read-only federation**\n\n**Full federation:**\nAdding Phase 3 enables:\n- Accepting follow requests\n- Follower tracking\n- Secure authenticated requests\n\n**Testing plan:**\n1. Search for account on Mastodon.social\n2. Verify profile loads\n3. Verify posts appear\n4. Test follow request (if Inbox implemented)\n\n**Success criteria:**\nUser can search for `@stepan@octodon.stepan-kuzmin.workers.dev` on mastodon.social and see posts in their timeline.\n\n**References:**\n- ActivityPub spec: https://www.w3.org/TR/activitypub/\n- Mastodon federation: https://docs.joinmastodon.org/spec/activitypub/\n- Federation guide: https://blog.joinmastodon.org/2018/06/how-to-implement-a-basic-activitypub-server/","status":"open","priority":1,"issue_type":"epic","created_at":"2025-11-02T16:30:50.974323+02:00","updated_at":"2025-11-02T16:30:50.974323+02:00"}
{"id":"octodon-2d31","content_hash":"31acb510c0072efd0adb9d1051f937a8f9616e880355675cf18b244cca4c5c76","title":"Implement OAuth authorization flow endpoints","description":"After implementing /api/v1/apps, Elk fails because it needs the full OAuth flow.\n\n**Current error:**\nElk redirects to `/oauth/authorize` which returns 404.\n\n**Missing endpoints:**\n1. `GET /oauth/authorize` - Authorization page (should auto-approve and redirect)\n2. `POST /oauth/token` - Exchange auth code for access token\n\n**OAuth Flow:**\n1. ✅ App registers via POST /api/v1/apps\n2. ❌ User redirected to GET /oauth/authorize?client_id=...\u0026redirect_uri=...\n3. ❌ Server redirects back with code: redirect_uri?code=AUTH_CODE\n4. ❌ App exchanges code via POST /oauth/token\n5. ✅ App uses token for API calls (we accept anything since API is public)\n\n**Implementation approach (stateless):**\n- Generate deterministic auth codes from client_id (no storage)\n- Auto-approve all requests (no user interaction needed)\n- Return fake access tokens (API doesn't validate them anyway)\n- Follow OAuth 2.0 response format\n\n**Request example:**\n```\nGET /oauth/authorize?client_id=9b55fa90a42cc18af8e49ac5509725e3\n  \u0026response_type=code\n  \u0026redirect_uri=https://elk.zone/api/octodon.stepan-kuzmin.workers.dev/oauth/https://elk.zone\n  \u0026scope=read+write+follow+push\n```\n\n**Blocks:** Elk preview functionality\n**Related:** octodon-c516 (completed but incomplete)","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-02T16:41:48.385774+02:00","updated_at":"2025-11-02T16:48:17.032389+02:00","closed_at":"2025-11-02T16:48:17.032389+02:00"}
{"id":"octodon-37a0","content_hash":"8f34fac65c22f27be2cefb8f4c94238a4cafb7ebf6b934d9d83c5a0d7e47cc70","title":"Implement GitHub OAuth bridge for authenticated posting via Elk","description":"Enable posting from Elk (and other Mastodon clients) using real GitHub authentication, committing posts as markdown to GitHub repository.\n\n## Architecture: OAuth Bridge (Stateless)\n\n**Flow:**\n1. User signs in via Elk → Octodon redirects to GitHub OAuth\n2. User authorizes GitHub → GitHub redirects back to Octodon\n3. Octodon validates user is owner, redirects back to Elk\n4. Elk gets token (encrypted GitHub token)\n5. User posts in Elk → Octodon commits markdown to GitHub\n6. GitHub Actions CI rebuilds → post appears\n\n**Key Innovation: STATELESS (No KV needed)**\n- Encode Elk redirect URI in HMAC-signed state parameter\n- Encrypt GitHub token, use as Mastodon authorization code\n- Use Node.js built-in Web Crypto API for encryption\n- Validate GitHub token on every request\n\n## Dependencies to Explore\n\n**Official GitHub packages:**\n- `@octokit/oauth-app` - Official GitHub OAuth library\n  - Has `createWebWorkerHandler` for edge runtimes\n  - Handles OAuth web flow, token exchange\n  - May work with Cloudflare Workers\n- `@octokit/rest` or `octokit` - For GitHub API calls\n  - Create commits, validate user\n\n**Built-in Node.js:**\n- Web Crypto API (`crypto.subtle`) - AES-GCM encryption/decryption\n- No custom crypto implementation needed\n\n**Research needed:**\n1. Verify @octokit/oauth-app works with Cloudflare Workers\n2. Check bundle size impact\n3. Determine if we can use just Octokit or need custom OAuth flow\n\n## Implementation Components\n\n**1. Crypto utilities** (~40 lines or use built-in)\n- encrypt(data, key) using crypto.subtle\n- decrypt(data, key)\n- signState(state, secret) using HMAC\n- verifyState(state, signature, secret)\n\n**2. GitHub OAuth endpoints** (~100 lines)\n- GET /oauth/authorize → Redirect to GitHub with signed state\n- GET /oauth/github/callback → Exchange code, encrypt token, redirect Elk\n- POST /oauth/token → Decrypt code, validate, return token\n\n**3. POST endpoint** (~60 lines)\n- POST /api/v1/statuses\n- Validate GitHub token (GET /user, check username)\n- Convert Mastodon status → markdown with frontmatter\n- Commit to GitHub: PUT /repos/{owner}/{repo}/contents/posts/{filename}.md\n- Optionally: Append to R2 JSON for instant visibility (hybrid model)\n\n**4. Secrets needed:**\n- GITHUB_CLIENT_ID (GitHub OAuth app)\n- GITHUB_CLIENT_SECRET\n- ENCRYPTION_KEY (for token encryption)\n- HMAC_SECRET (for state signing)\n- OWNER_GITHUB_USERNAME (validate only owner can post)\n\n## Decision Points\n\n**Option A: Use @octokit/oauth-app (if Workers-compatible)**\n- Pro: Battle-tested, official, handles OAuth flow\n- Con: Dependency, bundle size, may not work with Workers\n\n**Option B: Custom OAuth with built-in crypto**\n- Pro: No dependencies, full control, definitely works\n- Con: ~100 lines of OAuth logic\n\n**Option C: Hybrid - Octokit for API, custom OAuth flow**\n- Pro: Best of both - use Octokit for GitHub API, custom for OAuth\n- Con: Mixing approaches\n\n## Success Criteria\n\n✅ User can post from Elk\n✅ Post commits to GitHub as markdown\n✅ Only owner (validated via GitHub) can post\n✅ No KV storage needed (stateless)\n✅ CI rebuilds and post appears\n✅ Hybrid: Instant visibility + Git history\n\n## Estimated Complexity\n\n- New code: ~200-220 lines\n- Total: ~415 lines (still simple!)\n- Dependencies: Maybe 1 (Octokit) if Workers-compatible","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-04T21:26:54.523849+02:00","updated_at":"2025-11-04T22:05:42.999255+02:00","closed_at":"2025-11-04T22:05:42.999255+02:00"}
{"id":"octodon-3e6e","content_hash":"6e5835955280a63288093ee6063cea48f6f06a2b400fcaec195d4c967673cec9","title":"Move constants outside fetch function in worker.ts","description":"The corsHeaders object and preferences object are recreated on every request inside the fetch function. These never change and should be constants.\n\n**Current issues:**\n1. corsHeaders object created at line 17 (inside fetch function)\n2. preferences object created at line 223 (inside route handler)\n\n**Solution:**\nMove to top of file as constants:\n```typescript\nconst CORS_HEADERS = {\n  'Access-Control-Allow-Origin': '*',\n  'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n  'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n  'Content-Type': 'application/json',\n} as const;\n\nconst DEFAULT_PREFERENCES = {\n  'posting:default:visibility': 'public',\n  'posting:default:sensitive': false,\n  'posting:default:language': 'en',\n  'reading:expand:media': 'default',\n  'reading:expand:spoilers': false,\n} as const;\n```\n\n**Benefits:**\n- Clearer code structure\n- Tiny performance improvement (no object allocation per request)\n- Easier to find and modify constants\n\n**Impact:** Better structure, micro-optimization\n**Effort:** 2 minutes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-02T20:02:58.124248+02:00","updated_at":"2025-11-02T20:10:53.682728+02:00","closed_at":"2025-11-02T20:10:53.682728+02:00"}
{"id":"octodon-61de","content_hash":"7e025908ca1ff41b9719199cb566a6774eb1910479c52753093b6e770ce4f5f7","title":"Implement ActivityPub Outbox endpoint","description":"Implement ActivityPub Outbox endpoint to serve posts in ActivityPub format.\n\n**Endpoint:** `GET /users/{username}/outbox` with `Accept: application/activity+json` header\n\n**Response format (OrderedCollection):**\n```json\n{\n  \"@context\": \"https://www.w3.org/ns/activitystreams\",\n  \"id\": \"https://octodon.stepan-kuzmin.workers.dev/users/stepan/outbox\",\n  \"type\": \"OrderedCollection\",\n  \"totalItems\": 3,\n  \"first\": \"https://octodon.stepan-kuzmin.workers.dev/users/stepan/outbox?page=1\"\n}\n```\n\n**Paginated response:**\n```json\n{\n  \"@context\": \"https://www.w3.org/ns/activitystreams\",\n  \"id\": \"https://octodon.stepan-kuzmin.workers.dev/users/stepan/outbox?page=1\",\n  \"type\": \"OrderedCollectionPage\",\n  \"partOf\": \"https://octodon.stepan-kuzmin.workers.dev/users/stepan/outbox\",\n  \"orderedItems\": [\n    {\n      \"id\": \"https://octodon.stepan-kuzmin.workers.dev/users/stepan/statuses/1737796500000/activity\",\n      \"type\": \"Create\",\n      \"actor\": \"https://octodon.stepan-kuzmin.workers.dev/users/stepan\",\n      \"published\": \"2025-01-25T09:15:00.000Z\",\n      \"object\": {\n        \"id\": \"https://octodon.stepan-kuzmin.workers.dev/users/stepan/statuses/1737796500000\",\n        \"type\": \"Note\",\n        \"attributedTo\": \"https://octodon.stepan-kuzmin.workers.dev/users/stepan\",\n        \"content\": \"\u003cp\u003ePost content here\u003c/p\u003e\",\n        \"published\": \"2025-01-25T09:15:00.000Z\",\n        \"to\": [\"https://www.w3.org/ns/activitystreams#Public\"]\n      }\n    }\n  ]\n}\n```\n\n**Implementation notes:**\n- Convert statuses from posts.json to ActivityPub Create activities\n- Support pagination (optional, could return all for now)\n- Each post becomes a Create activity wrapping a Note object\n- Use proper ActivityPub URLs (/users/stepan/statuses/ID)\n\n**Dependencies:**\n- Requires Actor endpoint (octodon-0541)\n\n**References:**\n- ActivityPub Outbox: https://www.w3.org/TR/activitypub/#outbox\n- Mastodon implementation: https://docs.joinmastodon.org/spec/activitypub/#outbox","status":"open","priority":1,"issue_type":"feature","created_at":"2025-11-02T16:29:34.208854+02:00","updated_at":"2025-11-02T16:29:34.208854+02:00"}
{"id":"octodon-65c7","content_hash":"c4031b54dd0093a8df886f7b0b79f78fd15fc0cae511753c2d972c9a934b5892","title":"Extract duplicated crypto hash function in worker.ts","description":"The SHA-256 hashing code appears THREE times in worker.ts (lines 36-42, 76-80, 110-114). This is the same logic duplicated for:\n1. OAuth app registration (client_id generation)\n2. OAuth authorization (auth code generation)\n3. OAuth token exchange (access token generation)\n\n**Current code pattern (repeated 3x):**\n```typescript\nconst encoder = new TextEncoder();\nconst data = encoder.encode(input);\nconst hashBuffer = await crypto.subtle.digest('SHA-256', data);\nconst hashArray = Array.from(new Uint8Array(hashBuffer));\nconst result = hashArray.map(b =\u003e b.toString(16).padStart(2, '0')).join('');\n```\n\n**Solution:**\nExtract to helper function:\n```typescript\nasync function hashToHex(input: string): Promise\u003cstring\u003e {\n  const data = new TextEncoder().encode(input);\n  const hash = await crypto.subtle.digest('SHA-256', data);\n  const bytes = Array.from(new Uint8Array(hash));\n  return bytes.map(b =\u003e b.toString(16).padStart(2, '0')).join('');\n}\n```\n\n**Impact:** Remove ~15 lines of duplicated complexity\n**Effort:** 5 minutes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-02T20:02:40.462782+02:00","updated_at":"2025-11-02T20:08:36.557036+02:00","closed_at":"2025-11-02T20:08:36.557036+02:00"}
{"id":"octodon-6af9","content_hash":"216f25ac94ed06d38073c843aa37bc1d3c72cb233726a82703477412387fb4a4","title":"Implement HTTP Signatures for ActivityPub security","description":"Implement HTTP Signature verification and signing for secure ActivityPub federation.\n\n**Purpose:**\n- Verify incoming activities to Inbox are from legitimate servers\n- Sign outgoing activities when sending to other servers' inboxes\n- Required for production federation (most servers reject unsigned requests)\n\n**What's needed:**\n\n**1. Generate RSA key pair:**\n- Generate public/private key pair at build time or first run\n- Store private key securely (Cloudflare secret or R2)\n- Include public key in Actor endpoint response\n\n**2. Verify incoming signatures:**\n- Parse `Signature` header from incoming requests\n- Fetch sender's public key from their Actor endpoint\n- Verify request signature matches\n- Reject requests with invalid signatures\n\n**3. Sign outgoing requests:**\n- Sign requests when sending activities to other servers\n- Include `Signature` header with keyId, algorithm, headers, signature\n\n**Signature header format:**\n```\nSignature: keyId=\"https://octodon.stepan-kuzmin.workers.dev/users/stepan#main-key\",algorithm=\"rsa-sha256\",headers=\"(request-target) host date digest\",signature=\"...\"\n```\n\n**Implementation notes:**\n- Use Web Crypto API for RSA operations (available in Cloudflare Workers)\n- Cache fetched public keys to avoid repeated requests\n- For read-only mode (no outgoing activities), only verification needed\n- Consider using `http-signature` library or implement manually\n\n**Dependencies:**\n- Required for production Inbox (octodon-87e5)\n- Public key must be in Actor response (octodon-0541)\n\n**References:**\n- HTTP Signatures spec: https://datatracker.ietf.org/doc/html/draft-cavage-http-signatures\n- Mastodon implementation: https://docs.joinmastodon.org/spec/security/#http\n- Example: https://blog.joinmastodon.org/2018/06/how-to-implement-a-basic-activitypub-server/","status":"open","priority":2,"issue_type":"feature","created_at":"2025-11-02T16:30:12.120811+02:00","updated_at":"2025-11-02T16:30:12.120811+02:00"}
{"id":"octodon-8582","content_hash":"e15c1be040b4805cd4d44b1270d07082891be8632e493f07ac53319c5b540bc6","title":"Extract duplicated timeline logic in worker.ts","description":"Public timeline and home timeline have identical implementation (exact copy-paste). This violates DRY principle.\n\n**Duplication:**\n- Lines 151-158: GET /api/v1/timelines/public\n- Lines 235-242: GET /api/v1/timelines/home\n\nBoth do:\n1. Parse limit from query params (default 20, max 40)\n2. Slice statuses array\n3. Return JSON response\n\n**Solution:**\nExtract to helper function:\n```typescript\nfunction getTimelineResponse(data: PostsData, limitParam: string | null): Response {\n  const limit = Math.min(parseInt(limitParam || '20'), 40);\n  const statuses = data.statuses.slice(0, limit);\n  return jsonResponse(statuses);\n}\n```\n\nThen both routes become:\n```typescript\nif (url.pathname === '/api/v1/timelines/public') {\n  return getTimelineResponse(data, url.searchParams.get('limit'));\n}\n\nif (url.pathname === '/api/v1/timelines/home') {\n  return getTimelineResponse(data, url.searchParams.get('limit'));\n}\n```\n\n**Impact:** Removes duplication, single source of truth for timeline logic\n**Effort:** 5 minutes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-02T20:03:08.626153+02:00","updated_at":"2025-11-02T20:25:56.303379+02:00","closed_at":"2025-11-02T20:25:56.303379+02:00"}
{"id":"octodon-85c2","content_hash":"5fd1c0a0e1938dfdf321302cd7acea0df0f25bba55ab425971623f440cc248d0","title":"Implement ActivityPub Note/Object endpoints for individual posts","description":"Implement ActivityPub endpoints to serve individual posts as Note objects.\n\n**Endpoints:**\n- `GET /users/{username}/statuses/{id}` with `Accept: application/activity+json`\n- `GET /users/{username}/statuses/{id}/activity` (Create activity wrapper)\n\n**Note object response:**\n```json\n{\n  \"@context\": \"https://www.w3.org/ns/activitystreams\",\n  \"id\": \"https://octodon.stepan-kuzmin.workers.dev/users/stepan/statuses/1737796500000\",\n  \"type\": \"Note\",\n  \"attributedTo\": \"https://octodon.stepan-kuzmin.workers.dev/users/stepan\",\n  \"content\": \"\u003cp\u003ePost content in HTML\u003c/p\u003e\",\n  \"published\": \"2025-01-25T09:15:00.000Z\",\n  \"to\": [\"https://www.w3.org/ns/activitystreams#Public\"],\n  \"cc\": [\"https://octodon.stepan-kuzmin.workers.dev/users/stepan/followers\"],\n  \"url\": \"https://octodon.stepan-kuzmin.workers.dev/@stepan/1737796500000\"\n}\n```\n\n**Create activity response:**\n```json\n{\n  \"@context\": \"https://www.w3.org/ns/activitystreams\",\n  \"id\": \"https://octodon.stepan-kuzmin.workers.dev/users/stepan/statuses/1737796500000/activity\",\n  \"type\": \"Create\",\n  \"actor\": \"https://octodon.stepan-kuzmin.workers.dev/users/stepan\",\n  \"published\": \"2025-01-25T09:15:00.000Z\",\n  \"object\": { /* Note object above */ }\n}\n```\n\n**Implementation notes:**\n- Convert individual status from posts.json to ActivityPub Note\n- Support both direct Note access and wrapped Create activity\n- Return 404 if status ID not found\n- Add proper content-type and CORS headers\n\n**Dependencies:**\n- Requires Actor endpoint (octodon-0541)\n\n**References:**\n- ActivityPub Note: https://www.w3.org/TR/activitystreams-vocabulary/#dfn-note\n- Mastodon statuses: https://docs.joinmastodon.org/spec/activitypub/#Note","status":"open","priority":1,"issue_type":"feature","created_at":"2025-11-02T16:29:45.847063+02:00","updated_at":"2025-11-02T16:29:45.847063+02:00"}
{"id":"octodon-87e5","content_hash":"b8d7e316c4725b84011a8c8796d1c487b6f9643c118381de1ee830b970cd4546","title":"Implement ActivityPub Inbox endpoint for receiving activities","description":"Implement ActivityPub Inbox endpoint to receive federation activities (Follow, Like, Announce, etc.).\n\n**Endpoint:** `POST /users/{username}/inbox` with `Content-Type: application/activity+json`\n\n**Received activity examples:**\n\nFollow request:\n```json\n{\n  \"@context\": \"https://www.w3.org/ns/activitystreams\",\n  \"id\": \"https://mastodon.social/users/alice#follows/123\",\n  \"type\": \"Follow\",\n  \"actor\": \"https://mastodon.social/users/alice\",\n  \"object\": \"https://octodon.stepan-kuzmin.workers.dev/users/stepan\"\n}\n```\n\n**Implementation options:**\n\n**Option A: Accept-only (minimal):**\n- Accept POST requests\n- Return 202 Accepted\n- Don't store or process activities\n- Allows basic federation discovery but no real interactions\n\n**Option B: Auto-accept follows:**\n- Store followers in R2 or KV\n- Send Accept activity back to follower's inbox\n- Requires HTTP signatures for sending activities\n- Enables actual federation with follower notifications\n\n**Implementation notes:**\n- Verify HTTP signatures (required for production)\n- Validate activity format\n- For read-only mode, Option A is sufficient\n- For full federation, need Option B + persistent storage\n\n**Dependencies:**\n- Requires Actor endpoint (octodon-0541)\n- Option B requires HTTP signature implementation (see octodon-7f31)\n\n**References:**\n- ActivityPub Inbox: https://www.w3.org/TR/activitypub/#inbox\n- HTTP Signatures: https://docs.joinmastodon.org/spec/security/#http","status":"open","priority":2,"issue_type":"feature","created_at":"2025-11-02T16:29:58.298569+02:00","updated_at":"2025-11-02T16:29:58.298569+02:00"}
{"id":"octodon-9711","content_hash":"1935be673c2deab0a6bda173725deed9efea8c29c8b21c44e979a9ad65f9e4f7","title":"Implement WebFinger endpoint for account discovery","description":"Implement `.well-known/webfinger` endpoint to allow other Mastodon servers to discover accounts.\n\n**Endpoint:** `GET /.well-known/webfinger?resource=acct:stepan@octodon.stepan-kuzmin.workers.dev`\n\n**Response format:**\n```json\n{\n  \"subject\": \"acct:stepan@octodon.stepan-kuzmin.workers.dev\",\n  \"aliases\": [\n    \"https://octodon.stepan-kuzmin.workers.dev/@stepan\",\n    \"https://octodon.stepan-kuzmin.workers.dev/users/stepan\"\n  ],\n  \"links\": [\n    {\n      \"rel\": \"http://webfinger.net/rel/profile-page\",\n      \"type\": \"text/html\",\n      \"href\": \"https://octodon.stepan-kuzmin.workers.dev/@stepan\"\n    },\n    {\n      \"rel\": \"self\",\n      \"type\": \"application/activity+json\",\n      \"href\": \"https://octodon.stepan-kuzmin.workers.dev/users/stepan\"\n    }\n  ]\n}\n```\n\n**Implementation notes:**\n- Parse `resource` query parameter\n- Extract username from `acct:username@domain` format\n- Validate username matches account.json\n- Return 404 if username doesn't match\n- Add proper CORS headers\n\n**References:**\n- WebFinger RFC: https://tools.ietf.org/html/rfc7033\n- Mastodon WebFinger: https://docs.joinmastodon.org/spec/webfinger/","status":"open","priority":1,"issue_type":"feature","created_at":"2025-11-02T16:29:10.333363+02:00","updated_at":"2025-11-02T16:29:10.333363+02:00"}
{"id":"octodon-a639","content_hash":"d77fe276ff0243f133c2b164e94c5c963da6feb6c5500c96dd75dd4cb72d961c","title":"API returns 'Failed to load data' error after deployment","description":"After running npm run deploy, the API endpoint returns:\n```\n{\"error\":\"Failed to load data\"}\n```\n\nURL: https://octodon.stepan-kuzmin.workers.dev/api/v1/timelines/public\n\n**Likely cause:** The posts.json file may not have been uploaded to R2 with the --remote flag, or there's an R2 binding issue.\n\n**Steps to reproduce:**\n1. Deploy worker with `npm run deploy`\n2. Curl the API endpoint\n3. Receive error instead of data\n\n**Next steps:**\n1. Upload posts.json to R2 with: `npx wrangler r2 object put octodon-data/posts.json --file=dist/posts.json --remote`\n2. Verify file exists in R2: `npx wrangler r2 object get octodon-data/posts.json --file=test.json --remote`\n3. Check worker logs: `npx wrangler tail`\n4. Verify R2 binding in wrangler.toml","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-02T16:09:11.015058+02:00","updated_at":"2025-11-02T16:12:52.560998+02:00","closed_at":"2025-11-02T16:12:52.560998+02:00"}
{"id":"octodon-b418","content_hash":"c2e657175511aa7b8ee869db376fb858233728186f38d3b4358524222b371844","title":"Fix CORS headers to allow Authorization header","description":"Elk successfully authenticates but fails to fetch timeline and other data due to CORS errors.\n\n**Error from browser console:**\n```\nAccess to fetch at 'https://octodon.stepan-kuzmin.workers.dev/api/v1/...' from origin 'https://elk.zone' \nhas been blocked by CORS policy: Request header field authorization is not allowed by \nAccess-Control-Allow-Headers in preflight response.\n```\n\n**Root cause:**\nCurrent CORS headers only allow 'Content-Type':\n```javascript\n'Access-Control-Allow-Headers': 'Content-Type',\n```\n\nBut Elk sends Bearer token in Authorization header:\n```\nAuthorization: Bearer \u003caccess_token\u003e\n```\n\n**Fix:**\nUpdate CORS headers to include Authorization:\n```javascript\n'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n```\n\n**Blocks:** Elk timeline viewing after successful OAuth login","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-02T16:51:21.453999+02:00","updated_at":"2025-11-02T16:53:57.407755+02:00","closed_at":"2025-11-02T16:53:57.407755+02:00"}
{"id":"octodon-bc75","content_hash":"fc304c2fae4dd8e50f1a5df8d90ac77a19c1d53715fa84c9c1286a2a6f9a9053","title":"Add unit tests for worker API endpoints","description":"Write comprehensive unit tests for all Cloudflare Worker API endpoints using Node.js native test runner.\n\n**Endpoints to test:**\n- POST /api/v1/apps (OAuth app registration)\n- GET /oauth/authorize (OAuth authorization)\n- POST /oauth/token (OAuth token exchange)\n- GET /api/v1/timelines/public\n- GET /api/v1/timelines/home\n- GET /api/v1/statuses/:id\n- GET /api/v1/instance\n- GET /api/v1/accounts/:id\n- GET /api/v1/accounts/verify_credentials\n- GET /api/v1/preferences\n- OPTIONS (CORS preflight)\n- 404 handling\n\n**Testing approach:**\n- Use Node.js native test runner (node:test)\n- Mock R2 bucket with test data\n- Test happy paths and error cases\n- Keep tests simple and maintainable\n- No comments, just clear test descriptions\n\n**File:** test/worker.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-02T16:56:52.45677+02:00","updated_at":"2025-11-02T16:59:10.265544+02:00","closed_at":"2025-11-02T16:59:10.265544+02:00"}
{"id":"octodon-c516","content_hash":"a4cb839808aabb4bf305b83ef9053f7691f2368b8403275d6c8546138568f753","title":"Implement /api/v1/apps endpoint for Mastodon client compatibility","description":"Elk (and likely other Mastodon clients) cannot preview the instance in read-only mode because the server doesn't support app registration.\n\n**Error from Elk:**\n```\n{\"url\":\"/api/octodon.stepan-kuzmin.workers.dev/login\",\"statusCode\":400,\"statusMessage\":\"App not registered for server: octodon.stepan-kuzmin.workers.dev\",\"message\":\"App not registered for server: octodon.stepan-kuzmin.workers.dev\"}\n```\n\n**Root Cause:**\nMastodon clients (like Elk, Ivory, Phanpy) expect to register an OAuth application via the `POST /api/v1/apps` endpoint before accessing the API, even in read-only mode.\n\n**What's needed:**\nImplement `POST /api/v1/apps` endpoint in worker.ts that:\n1. Accepts app registration requests with `client_name`, `redirect_uris`, `scopes`, `website`\n2. Returns a mock OAuth app response with `client_id` and `client_secret`\n3. Doesn't need to persist data (can generate dummy credentials)\n4. Allows clients to proceed with public/anonymous timeline browsing\n\n**Expected behavior:**\nAfter implementing this, users should be able to add the instance to Elk and other Mastodon clients and browse public posts in read-only mode.\n\n**References:**\n- Mastodon API docs: https://docs.joinmastodon.org/methods/apps/#create\n- Elk login flow: `POST /api/{server}/login` → requires app registration first","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-02T16:26:52.095718+02:00","updated_at":"2025-11-02T16:40:05.887035+02:00","closed_at":"2025-11-02T16:40:05.887035+02:00"}
{"id":"octodon-cb8d","content_hash":"d43b55d535c607d12d9dc532a627a71893713fd66cc5aab6768d5430544e4b02","title":"Remove hardcoded links in build.ts and use account.json whenever possible","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-02T16:20:13.919477+02:00","updated_at":"2025-11-02T16:21:47.314405+02:00","closed_at":"2025-11-02T16:21:47.314405+02:00"}
{"id":"octodon-ccf3","content_hash":"1888be00bbd06eb070e17661b2a1b763e638f56fa7d441376cbbe4132788906b","title":"Implement followers and following collection endpoints","description":"Implement ActivityPub collection endpoints for followers and following lists.\n\n**Endpoints:**\n- `GET /users/{username}/followers` \n- `GET /users/{username}/following`\n\n**Response format (OrderedCollection):**\n```json\n{\n  \"@context\": \"https://www.w3.org/ns/activitystreams\",\n  \"id\": \"https://octodon.stepan-kuzmin.workers.dev/users/stepan/followers\",\n  \"type\": \"OrderedCollection\",\n  \"totalItems\": 0,\n  \"first\": \"https://octodon.stepan-kuzmin.workers.dev/users/stepan/followers?page=1\"\n}\n```\n\n**Implementation options:**\n\n**Option A: Empty collections (minimal):**\n- Return empty collections with totalItems: 0\n- No persistence needed\n- Sufficient for read-only federation\n\n**Option B: Actual follower tracking:**\n- Store followers in R2 or Cloudflare KV\n- Track when Follow activities are accepted\n- Return paginated list of follower Actor IDs\n- Enables proper federation with follower counts\n\n**Implementation notes:**\n- For static Octodon, following list is always empty (no following anyone)\n- Followers list requires Inbox processing and storage\n- Can start with Option A and upgrade to Option B later\n- Add proper content-type and CORS headers\n\n**Dependencies:**\n- Requires Actor endpoint (octodon-0541)\n- Option B requires Inbox implementation (octodon-87e5)\n\n**References:**\n- ActivityPub Collections: https://www.w3.org/TR/activitypub/#collections\n- Mastodon collections: https://docs.joinmastodon.org/spec/activitypub/#Collection","status":"open","priority":3,"issue_type":"feature","created_at":"2025-11-02T16:30:22.852126+02:00","updated_at":"2025-11-02T16:30:22.852126+02:00"}
{"id":"octodon-d433","content_hash":"e7d6f1edb4da7fd24a9d6e4c29626f9f6261d0c04350dc12b1f37e63320f16d9","title":"Extract date parsing logic in build.ts","description":"Date extraction logic has complex ternary chain that makes priority unclear.\n\n**Current code (lines 37-38):**\n```typescript\nconst dateMatch = filename.match(/(\\d{4}-\\d{2}-\\d{2})/);\nconst dateStr = postData.date || (dateMatch ? `${dateMatch[1]}T12:00:00.000Z` : new Date().toISOString());\n```\n\nLong ternary with nested logic. Priority: frontmatter → filename → now.\n\n**Solution:**\nExtract to explicit function:\n```typescript\nfunction extractPostDate(postData: PostData, filename: string): Date {\n  // 1. Try frontmatter date\n  if (postData.date) {\n    return new Date(postData.date);\n  }\n  \n  // 2. Try filename pattern YYYY-MM-DD\n  const dateMatch = filename.match(/(\\d{4}-\\d{2}-\\d{2})/);\n  if (dateMatch) {\n    return new Date(`${dateMatch[1]}T12:00:00.000Z`);\n  }\n  \n  // 3. Fallback to now\n  return new Date();\n}\n\nconst date = extractPostDate(postData, filename);\n```\n\n**Benefits:**\n- Clear priority order (numbered steps)\n- Function name documents intent\n- Easy to understand at 3am\n\n**Impact:** More maintainable date handling\n**Effort:** 5 minutes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-02T20:06:49.237418+02:00","updated_at":"2025-11-02T20:48:42.578745+02:00","closed_at":"2025-11-02T20:48:42.578745+02:00"}
{"id":"octodon-f2e2","content_hash":"f2467978a76cfa576cf42ee12ae800992ac4dd530f1df1f7bd1121e6091bb1b3","title":"Add JSON response helper functions to worker.ts","description":"Every endpoint manually constructs Response objects with JSON.stringify and headers. This is repetitive and error-prone.\n\n**Current pattern (repeated ~15 times):**\n```typescript\nreturn new Response(JSON.stringify(data), { \n  status: 200,\n  headers: corsHeaders \n});\n\nreturn new Response(JSON.stringify({ error: 'Message' }), {\n  status: 404,\n  headers: corsHeaders,\n});\n```\n\n**Solution:**\nAdd helper functions at top of file:\n```typescript\nfunction jsonResponse(data: unknown, status = 200): Response {\n  return new Response(JSON.stringify(data), { \n    status, \n    headers: CORS_HEADERS \n  });\n}\n\nfunction errorResponse(message: string, status: number): Response {\n  return jsonResponse({ error: message }, status);\n}\n```\n\n**Then use:**\n```typescript\nreturn jsonResponse(statuses);\nreturn errorResponse('Record not found', 404);\n```\n\n**Impact:** Cleaner, more consistent code across all endpoints\n**Effort:** 10 minutes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-02T20:02:49.098083+02:00","updated_at":"2025-11-02T20:16:48.737863+02:00","closed_at":"2025-11-02T20:16:48.737863+02:00"}
{"id":"octodon-fdfd","content_hash":"c95bc1f188524b076865127e95b2e24c4d75274cb467d1142630a160a6abf895","title":"Implement public read-only OAuth pattern","description":"Make OAuth explicitly public and read-only to be honest about single-user, public instance nature.\n\n**Changes needed:**\n\n1. Rename credentials to indicate public nature:\n   - client_id: 'octodon_public_readonly'\n   - client_secret: 'octodon_public_readonly'\n   - access_token: 'octodon_public_readonly_token'\n\n2. Update instance description:\n   - Explain single-user, public, read-only model\n   - Clarify OAuth is for client compatibility only\n\n3. Add clear documentation header explaining:\n   - Credentials are public and documented\n   - Everyone gets same credentials\n   - No real authentication happens\n   - All data is public\n\n4. Update README to document public credentials\n\n5. Verify Elk still works with renamed credentials\n\n**Philosophy:**\nInstead of hiding that OAuth is fake, make it explicitly public.\nHonest = transparent about what we're doing and why.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-03T20:33:50.137907+02:00","updated_at":"2025-11-03T21:13:09.214722+02:00","closed_at":"2025-11-03T21:13:09.214722+02:00"}
